version: "3.1"

intents:
  - greet
  - help
  - search_by_category
  - select_by_index
  - ask_recipe_ingredients
  - search_by_name
  - search_by_ingredients
  - surprise_me
  - filter_by_difficulty
  - suggest_similar_recipes
  - guided_search
  - add_to_shopping_list
  - clear_shopping_list
  - show_shopping_list

entities:
  - category
  - recipe_name
  - ingredient
  - difficulty
  - number

slots:
  category:
    type: text
    influence_conversation: true
    mappings:
      # PrioritÃ  all'entitÃ  se l'intent Ã¨ chiaro
      - type: from_entity
        entity: category
        intent: [inform, search_by_category, guided_search]
      # Fallback: se nel form non capisce l'entitÃ , prende il testo
      - type: from_text
        conditions:
        - active_loop: guided_search_form
          requested_slot: category

  difficulty:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: difficulty
        intent: [inform, filter_by_difficulty, guided_search]
      - type: from_text
        conditions:
        - active_loop: guided_search_form
          requested_slot: difficulty

  ingredients:
    type: list
    influence_conversation: true
    mappings:
      # Se l'utente usa l'intent esplicito "search_by_ingredients"
      - type: from_entity
        entity: ingredient
        intent: [search_by_ingredients]

      # Caso generico (inform): si accetta solo se si Ã¨ nel form
      - type: from_entity
        entity: ingredient
        intent: [inform, guided_search]
        conditions:
         - active_loop: guided_search_form
           requested_slot: ingredients

      # Fallback testuale
      - type: from_text
        conditions:
        - active_loop: guided_search_form
          requested_slot: ingredients

  num_people:
    type: float
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: number
        intent: [inform, guided_search]
      - type: from_text
        conditions:
        - active_loop: guided_search_form
          requested_slot: num_people

  last_recipes:
    type: list
    influence_conversation: false
    mappings:
      - type: custom

  recipe_name:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: recipe_name

  recipe_index:
    type: text
    influence_conversation: false
    mappings:
      - type: custom

  shopping_list:
    type: any
    influence_conversation: false
    mappings:
      - type: custom

forms:
  guided_search_form:
    required_slots:
      - category
      - difficulty
      - ingredients
      - num_people

responses:
  utter_greet:
    - custom:
        text: "Ciao! Sono <b>ProntoChef</b> ğŸ. Cosa bolle in pentola oggi?"
        parse_mode: "HTML"
    - custom:
        text: "Benvenuto! ğŸ‘¨â€ğŸ³ <b>Sono ProntoChef</b>, il tuo assistente ai fornelli. Hai giÃ  fame?"
        parse_mode: "HTML"
    - custom:
        text: "Ehi! ğŸ‘‹ Sono <b>ProntoChef</b>. Dimmi cosa hai nel frigo e ti dirÃ² cosa mangiare!"
        parse_mode: "HTML"
    - custom:
        text: "Ciao! Sono <b>ProntoChef</b>. Pronto a mettere le mani in pasta? ğŸ• Sono qui per aiutarti."
        parse_mode: "HTML"
    - custom:
        text: "Salve! ğŸ½ï¸ Sono <b>ProntoChef</b>. Cerchi ispirazione o hai giÃ  un ingrediente in mente?"
        parse_mode: "HTML"
    - custom:
        text: "Benvenuto nella mia cucina virtuale! Sono <b>ProntoChef</b>. ğŸ¥• Oggi prepariamo qualcosa di speciale?"
        parse_mode: "HTML"
  utter_help:
    - custom:
        text: |
          ğŸ‘¨â€ğŸ³ <b>Ecco cosa posso fare per te!</b>

          ğŸ” <b>COSA PUOI CHIEDERMI SUBITO</b>
          ğŸ¥¦ <b>Svuotafrigo:</b> "Ho zucchine e gamberetti". Dimmi gli ingredienti e ti suggerirÃ² delle ricette
          ğŸ <b>Nome:</b> "Mostrami una ricetta per i pancake allo yogurt"
          ğŸ° <b>Categoria:</b> "Voglio un dolce". Puoi scegliere tra antipasti, primi piatti, secondi piatti, dolci, lievitati,
          piatti unici, contorni, torte salate, salse e sughi, bevande, marmellate e conserve e insalate.
          âš¡ <b>Filtra:</b> "Voglio una ricetta facile"
          ğŸ§­ <b>Guidata:</b> "Guidami nella scelta" e io ti farÃ² alcune domande per trovare qualcosa che fa al caso tuo
          ğŸ² <b>Sorpresa:</b> "Sorprendimi!" e io ti proporrÃ² una ricetta a caso
          ğŸ›’ <b>Carrello:</b> "Mostra la lista della spesa" o "Svuota la lista"

          ğŸ“‹ <b>DOPO AVER VISTO I RISULTATI</b>
          <i>(Quando ti mostro un elenco di ricette...)</i>
          1ï¸âƒ£ <b>Scegli:</b> "Fammi vedere la prima" per visualizzare i dettagli di una ricetta
          ğŸ”„ <b>Simili:</b> "Hai qualcosa di simile?" per vedere una ricetta con ingredienti simili
          ğŸ“ <b>Dettagli:</b> "Che ingredienti servono?" per vedere solo la lista degli ingredienti
          ğŸ›ï¸ <b>Spesa:</b> "Aggiungi alla lista della spesa" per salvare e poter gestire la lista della tua spesa

          ğŸ’¡ <i>Prova a iniziare dicendomi cosa hai nel frigo o di che tipo di piatto hai voglia!</i>
        parse_mode: "HTML"
  utter_searching:
    - text: "Sto cercando delle ricette per te...ğŸ"
  utter_ask_category:
    - text: "ğŸ½ï¸ Che tipo di piatto cerchi? (primo, secondo, dolce, ecc.)"
  utter_no_category_results:
    - text: "Non ho trovato ricette per la categoria '{category}' ğŸ˜•"
  utter_ask_select_from_list:
    - text: "ğŸ‘‡ Dimmi il nome della ricetta che vuoi leggere, oppure scrivimi 'la prima'!"
  utter_ask_search_term:
    - text: "ğŸ” Che ricetta stai cercando? Scrivimi il nome (es. TiramisÃ¹)."
  utter_searching_feedback:
    - text: "ğŸ” Cerco {query} nel ricettario..."
  utter_no_recipes_found:
    - text: "ğŸ˜• Non ho trovato ricette per '{query}'."
  utter_recipe_data_error:
    - text: "ğŸš« C'Ã¨ stato un problema nel recuperare i dettagli per {recipe_name}."
  utter_no_list_active:
    - text: "ğŸ¤·â€â™‚ï¸ Non ho ancora suggerito nessuna ricetta da cui scegliere."
  utter_number_not_understood:
    - text: "ğŸ¤” Non ho capito quale numero hai scelto. Scrivimi semplicemente '1', '2' ecc."
  utter_number_out_of_bounds:
    - text: "âš ï¸ Il numero deve essere compreso tra 1 e {max_number}."
  utter_selection_confirmed:
    - text: "âœ… Hai scelto: {recipe_name}"
  utter_ask_specify_recipe_for_ingredients:
    - text: "ğŸ¤” Non ho capito a quale piatto ti riferisci. Dimmi il nome o la posizione."
  utter_recipe_not_found_ingredients:
    - text: "ğŸš« Non ho trovato dati per '{recipe_name}' nel mio ricettario."
  utter_no_ingredients_data:
    - text: "âš ï¸ Ops, questa ricetta esiste ma non ha ingredienti registrati nel database."
  utter_ask_ingredients_missing:
    - text: "ğŸ… Dimmi cosa hai in frigo! CercherÃ² una ricetta basata sui tuoi ingredienti. (Es. ho zucchine e gamberetti)"
  utter_ingredients_search_success:
    - text: "ğŸ‘¨â€ğŸ³ Ho trovato queste ricette con {ingredients_list}:"
  utter_no_recipes_by_ingredients:
    - text: "ğŸ˜• Non ho trovato nessuna ricetta che usi tutti questi ingredienti: {ingredients_list}."
  utter_empty_database:
    - text: "ğŸ“­ Ops, il mio ricettario sembra vuoto al momento! Non posso pescare nulla."
  utter_surprise_error:
    - text: "ğŸ˜… Il dado Ã¨ caduto male... Ho avuto un problema tecnico nel pescare la ricetta."
  utter_ask_difficulty:
    - text: "ğŸ¤” Che livello di difficoltÃ  preferisci? (facile, media, difficile)"
  utter_no_difficulty_results:
    - text: "ğŸš« Non ho trovato ricette con difficoltÃ  '{difficulty}'."
  utter_ask_context_for_similar:
    - text: "ğŸ¤” A quale piatto ti riferisci? Dimmi prima una ricetta, cosÃ¬ posso trovarti delle alternative!"
  utter_no_similar_recipes:
    - text: "ğŸ˜• Non ho trovato nulla di simile a '{recipe_name}'. Ãˆ una ricetta unica nel suo genere!"
  utter_ask_ingredients:
    - text: "ğŸ¥• Hai qualche ingrediente da usare? (puoi dirne piÃ¹ di uno oppure scrivere 'no')"
  utter_ask_num_people:
    - text: "ğŸ‘¥ Per quante persone?"
  utter_no_guided_results:
    - text: "ğŸ˜• Non ho trovato nessuna ricetta che soddisfi tutti i criteri che mi hai dato. Prova a essere meno specifico!"
  utter_guided_search_header:
    - text: "âœ… Ricerca completata! Ecco {count} proposte su misura che potrebbero piacerti ğŸ½ï¸:"
  utter_ask_recipe_for_shopping:
    - text: "ğŸ¤·â€â™‚ï¸ Quale ricetta devo aggiungere? Selezionane prima una!"
  utter_shopping_list_cleared:
    - text: "Ho svuotato la tua lista della spesa! ğŸ—‘ï¸"
  utter_added_to_shopping_list:
    - text: "Ho aggiunto gli ingredienti di {recipe_name} alla tua lista! ğŸ›’"
  tter_check_shopping_list_footer:
    - text: "ğŸ’¡ Se vuoi controllare il totale, dimmi 'Fammi vedere la lista'."
  utter_shopping_list_empty:
    - text: "ğŸ›’ Il carrello Ã¨ vuoto. Cerca una ricetta e dÃ¬ 'aggiungi alla lista'!"
  utter_shopping_list_footer:
    - text: "ğŸ’¡ Quando hai fatto la spesa, dimmi 'Svuota la lista' per ricominciare!"
  utter_default:
    - text: "Scusa, non ho capito cosa intendi ğŸ˜•. Posso cercare ricette, mostrarti il carrello o aiutarti a scegliere."
    - text: "Mmm, questo Ã¨ fuori dalla mia portata culinaria ğŸ³. Prova a chiedermi una ricetta!"

actions:
  - action_search_by_category
  - action_smart_recipe_handler
  - action_select_by_index
  - action_ask_recipe_ingredients
  - action_search_by_ingredients
  - action_surprise_me
  - action_filter_by_difficulty
  - action_suggest_similar_recipes
  - action_start_guided_search_form
  - action_submit_guided_search
  - validate_guided_search_form
  - action_show_shopping_list
  - action_add_to_shopping_list
  - action_clear_shopping_list
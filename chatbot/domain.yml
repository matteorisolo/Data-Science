version: "3.1"

intents:
  - greet
  - help
  - search_by_category
  - select_from_last_recipes
  - select_by_index
  - ask_recipe_ingredients
  - search_by_name
  - search_by_ingredients
  - surprise_me
  - filter_by_difficulty
  - suggest_similar_recipes
  - guided_search
  - add_to_shopping_list    # "Aggiungi questa ricetta alla spesa"
  - clear_shopping_list     # "Svuota la lista"
  - show_shopping_list      # (Lo hai gi√†, ma lo aggiorneremo)

entities:
  - category
  - recipe_name
  - ingredient
  - difficulty
  - number  # Aggiunto perch√® usato in num_people

slots:
  category:
    type: text
    influence_conversation: true
    mappings:
      # 1. Priorit√† all'entit√† se l'intent √® chiaro (Laptop Style)
      - type: from_entity
        entity: category
        intent: [inform, search_by_category, guided_search]
      # 2. Fallback: se nel form non capisce l'entit√†, prende il testo
      - type: from_text
        conditions:
        - active_loop: guided_search_form
          requested_slot: category

  difficulty:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: difficulty
        intent: [inform, filter_by_difficulty, guided_search]
      - type: from_text
        conditions:
        - active_loop: guided_search_form
          requested_slot: difficulty

  ingredients:
    type: list
    influence_conversation: true
    mappings:
      # Qui from_entity riempie la lista automaticamente
      - type: from_entity
        entity: ingredient
        intent: [inform, search_by_ingredients, guided_search]
      # Fallback testuale (la validate action poi lo trasformer√† in lista)
      - type: from_text
        conditions:
        - active_loop: guided_search_form
          requested_slot: ingredients

  num_people:
    type: float
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: number
        intent: [inform, guided_search]
      - type: from_text
        conditions:
        - active_loop: guided_search_form
          requested_slot: num_people

  last_recipes:
    type: list
    influence_conversation: false
    mappings:
      - type: custom

  recipe_name:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: recipe_name

  recipe_index:
    type: text
    influence_conversation: false
    mappings:
      - type: custom

  shopping_list:
    type: any      # Conterr√† un Dizionario Python: {"uova": "4", "farina": "500g"}
    influence_conversation: false
    mappings:
      - type: custom

forms:
  guided_search_form:
    required_slots:
      - category
      - difficulty
      - ingredients
      - num_people

responses:
  utter_greet:
    - text: "Ciao! Sono RecipeBot üçù"
  utter_help:
    - text: |
        Posso aiutarti a:
        - cercare ricette per categoria
        - filtrare per difficolt√†
        - suggerirti cosa cucinare
  utter_searching:
    - text: "Sto cercando delle ricette per te...üçù"
  utter_ask_category:
    - text: "Che tipo di piatto vuoi? (primo, secondo, dolce, ecc.)"
  utter_ask_difficulty:
    - text: "Che livello di difficolt√† preferisci? (facile, media, difficile)"
  utter_ask_ingredients:
    - text: "Hai qualche ingrediente da usare? (puoi dirne pi√π di uno oppure scrivere 'no')"
  utter_ask_num_people:
    - text: "Per quante persone?"
  utter_no_results:
    - text: "Non ho trovato ricette con questi criteri üòï"
  utter_shopping_list_cleared:
    - text: "Ho svuotato la tua lista della spesa! üóëÔ∏è"
  utter_added_to_list:
    - text: "Ho aggiunto gli ingredienti di {recipe_name} alla tua lista! üõí"
  utter_default:
    - text: "Scusa, non ho capito cosa intendi üòï. Posso cercare ricette, mostrarti il carrello o aiutarti a scegliere."
    - text: "Mmm, questo √® fuori dalla mia portata culinaria üç≥. Prova a chiedermi una ricetta!"

actions:
  - action_search_by_category
  - action_select_recipe
  - action_select_by_index
  - action_ask_recipe_ingredients
  - action_search_by_name
  - action_search_by_ingredients
  - action_surprise_me
  - action_filter_by_difficulty
  - action_suggest_similar_recipes
  - action_start_guided_search_form
  - action_submit_guided_search
  - validate_guided_search_form
  - action_show_shopping_list
  - action_add_to_shopping_list
  - action_clear_shopping_list
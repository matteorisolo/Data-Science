version: "3.1"

intents:
  - greet
  - help
  - search_by_category
  - select_from_last_recipes
  - select_by_index
  - ask_recipe_ingredients
  - search_by_name
  - search_by_ingredients
  - surprise_me
  - filter_by_difficulty
  - suggest_similar_recipes
  - guided_search
  - add_to_shopping_list    # "Aggiungi questa ricetta alla spesa"
  - clear_shopping_list     # "Svuota la lista"
  - show_shopping_list      # (Lo hai giÃ , ma lo aggiorneremo)

entities:
  - category
  - recipe_name
  - ingredient
  - difficulty
  - number  # Aggiunto perchÃ¨ usato in num_people

slots:
  category:
    type: text
    influence_conversation: true
    mappings:
      # 1. PrioritÃ  all'entitÃ  se l'intent Ã¨ chiaro (Laptop Style)
      - type: from_entity
        entity: category
        intent: [inform, search_by_category, guided_search]
      # 2. Fallback: se nel form non capisce l'entitÃ , prende il testo
      - type: from_text
        conditions:
        - active_loop: guided_search_form
          requested_slot: category

  difficulty:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: difficulty
        intent: [inform, filter_by_difficulty, guided_search]
      - type: from_text
        conditions:
        - active_loop: guided_search_form
          requested_slot: difficulty

  ingredients:
    type: list
    influence_conversation: true
    mappings:
      # Qui from_entity riempie la lista automaticamente
      - type: from_entity
        entity: ingredient
        intent: [inform, search_by_ingredients, guided_search]
      # Fallback testuale (la validate action poi lo trasformerÃ  in lista)
      - type: from_text
        conditions:
        - active_loop: guided_search_form
          requested_slot: ingredients

  num_people:
    type: float
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: number
        intent: [inform, guided_search]
      - type: from_text
        conditions:
        - active_loop: guided_search_form
          requested_slot: num_people

  last_recipes:
    type: list
    influence_conversation: false
    mappings:
      - type: custom

  recipe_name:
    type: text
    influence_conversation: true
    mappings:
      - type: from_entity
        entity: recipe_name

  recipe_index:
    type: text
    influence_conversation: false
    mappings:
      - type: custom

  shopping_list:
    type: any      # ConterrÃ  un Dizionario Python: {"uova": "4", "farina": "500g"}
    influence_conversation: false
    mappings:
      - type: custom

forms:
  guided_search_form:
    required_slots:
      - category
      - difficulty
      - ingredients
      - num_people

responses:
  utter_greet:
    - custom:
        text: "Ciao! Sono <b>ProntoChef</b> ğŸ. Cosa bolle in pentola oggi?"
        parse_mode: "HTML"
    - custom:
        text: "Benvenuto! ğŸ‘¨â€ğŸ³ <b>Sono ProntoChef</b>, il tuo assistente ai fornelli. Hai giÃ  fame?"
        parse_mode: "HTML"
    - custom:
        text: "Ehi! ğŸ‘‹ Sono <b>ProntoChef</b>. Dimmi cosa hai nel frigo e ti dirÃ² cosa mangiare!"
        parse_mode: "HTML"
    - custom:
        text: "Ciao! Sono <b>ProntoChef</b>. Pronto a mettere le mani in pasta? ğŸ• Sono qui per aiutarti."
        parse_mode: "HTML"
    - custom:
        text: "Salve! ğŸ½ï¸ Sono <b>ProntoChef</b>. Cerchi ispirazione o hai giÃ  un ingrediente in mente?"
        parse_mode: "HTML"
    - custom:
        text: "Benvenuto nella mia cucina virtuale! Sono <b>ProntoChef</b>. ğŸ¥• Oggi prepariamo qualcosa di speciale?"
        parse_mode: "HTML"
  utter_help:
    - custom:
        text: |
          ğŸ‘¨â€ğŸ³ <b>Ecco cosa posso fare per te!</b>

          ğŸ” <b>COSA PUOI CHIEDERMI SUBITO</b>
          ğŸ¥¦ <b>Svuotafrigo:</b> "Ho zucchine e gamberetti". Dimmi gli ingredienti e ti suggerirÃ² delle ricette
          ğŸ <b>Nome:</b> "Mostrami una ricetta per i pancake allo yogurt"
          ğŸ° <b>Categoria:</b> "Voglio un dolce". Puoi scegliere tra antipasti, primi piatti, secondi piatti, dolci, lievitati,
          piatti unici, contorni, torte salate, salse e sughi, bevande, marmellate e conserve e insalate.
          âš¡ <b>Filtra:</b> "Voglio una ricetta facile"
          ğŸ§­ <b>Guidata:</b> "Guidami nella scelta" e io ti farÃ² alcune domande per trovare qualcosa che fa al caso tuo
          ğŸ² <b>Sorpresa:</b> "Sorprendimi!" e io ti proporrÃ² una ricetta a caso
          ğŸ›’ <b>Carrello:</b> "Mostra la lista della spesa" o "Svuota la lista"

          ğŸ“‹ <b>DOPO AVER VISTO I RISULTATI</b>
          <i>(Quando ti mostro un elenco di ricette...)</i>
          1ï¸âƒ£ <b>Scegli:</b> "Fammi vedere la prima" per visualizzare i dettagli di una ricetta
          ğŸ”„ <b>Simili:</b> "Hai qualcosa di simile?" per vedere una ricetta con ingredienti simili
          ğŸ“ <b>Dettagli:</b> "Che ingredienti servono?" per vedere solo la lista degli ingredienti
          ğŸ›ï¸ <b>Spesa:</b> "Aggiungi alla lista della spesa" per salvare e poter gestire la lista della tua spesa

          ğŸ’¡ <i>Prova a iniziare dicendomi cosa hai nel frigo o di che tipo di piatto hai voglia!</i>
        parse_mode: "HTML"
  utter_searching:
    - text: "Sto cercando delle ricette per te...ğŸ"
  utter_ask_category:
    - text: "Che tipo di piatto vuoi? (primo, secondo, dolce, ecc.)"
  utter_ask_difficulty:
    - text: "Che livello di difficoltÃ  preferisci? (facile, media, difficile)"
  utter_ask_ingredients:
    - text: "Hai qualche ingrediente da usare? (puoi dirne piÃ¹ di uno oppure scrivere 'no')"
  utter_ask_num_people:
    - text: "Per quante persone?"
  utter_no_results:
    - text: "Non ho trovato ricette con questi criteri ğŸ˜•"
  utter_shopping_list_cleared:
    - text: "Ho svuotato la tua lista della spesa! ğŸ—‘ï¸"
  utter_added_to_list:
    - text: "Ho aggiunto gli ingredienti di {recipe_name} alla tua lista! ğŸ›’"
  utter_default:
    - text: "Scusa, non ho capito cosa intendi ğŸ˜•. Posso cercare ricette, mostrarti il carrello o aiutarti a scegliere."
    - text: "Mmm, questo Ã¨ fuori dalla mia portata culinaria ğŸ³. Prova a chiedermi una ricetta!"

actions:
  - action_search_by_category
  - action_select_recipe
  - action_select_by_index
  - action_ask_recipe_ingredients
  - action_search_by_name
  - action_search_by_ingredients
  - action_surprise_me
  - action_filter_by_difficulty
  - action_suggest_similar_recipes
  - action_start_guided_search_form
  - action_submit_guided_search
  - validate_guided_search_form
  - action_show_shopping_list
  - action_add_to_shopping_list
  - action_clear_shopping_list